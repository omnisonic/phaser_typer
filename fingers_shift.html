<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Typing Tutor</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/phaser/3.55.2/phaser.min.js"></script>
    <style>
        body {
            margin: 0;
        }
    </style>
</head>
<body>

<script>
    const keyToFingerMapping = {
        '1': 'left hand pinky',
        '2': 'left hand ring finger',
        '3': 'left hand middle finger',
        '4': 'left hand index finger',
        '5': 'left hand index finger',
        '6': 'right hand index finger',
        '7': 'right hand index finger',
        '8': 'right hand middle finger',
        '9': 'right hand ring finger',
        '0': 'right hand pinky',
        'q': 'left hand pinky',
        'w': 'left hand ring finger',
        'e': 'left hand middle finger',
        'r': 'left hand index finger',
        't': 'left hand index finger',
        'y': 'right hand index finger',
        'u': 'right hand index finger',
        'i': 'right hand middle finger',
        'o': 'right hand ring finger',
        'p': 'right hand pinky',
        'a': 'left hand pinky',
        's': 'left hand ring finger',
        'd': 'left hand middle finger',
        'f': 'left hand index finger',
        'g': 'left hand index finger',
        'h': 'right hand index finger',
        'j': 'right hand index finger',
        'k': 'right hand middle finger',
        'l': 'right hand ring finger',
        ';': 'right hand pinky',
        'z': 'left hand pinky',
        'x': 'left hand ring finger',
        'c': 'left hand middle finger',
        'v': 'left hand index finger',
        'b': 'left hand index finger',
        'n': 'right hand index finger',
        'm': 'right hand index finger',
        ',': 'right hand middle finger',
        '.': 'right hand ring finger',
        '/': 'right hand pinky',
        // Add the shift characters and other special characters
            '+': 'right hand pinky', // same as '='
    '~': 'left hand pinky', // same as '`'
    '!': 'left hand pinky', // same as '1'
    '@': 'left hand ring finger', // same as '2'
    '#': 'left hand middle finger', // same as '3'
    '$': 'left hand index finger', // same as '4'
    '%': 'left hand index finger', // same as '5'
    '^': 'right hand index finger', // same as '6'
    '&': 'right hand index finger', // same as '7'
    '*': 'right hand middle finger', // same as '8'
    '(': 'right hand ring finger', // same as '9'
    ')': 'right hand pinky', // same as '0'
    '_': 'right hand pinky', // same as '-'
            '{': 'right hand pinky', // same as '['
    '}': 'right hand pinky', // same as ']'
    '|': 'right hand pinky', // same as '\\'
    '<': 'right hand middle finger', // same as ','
    '>': 'right hand ring finger', // same as '.'
    '?': 'right hand pinky', // same as '/'
    ':': 'right hand ring finger', // same as ';'
    '"': 'right hand pinky', // same as '\''

// ... etc.
    };

    // You can access the data like this:

const config = {
    type: Phaser.AUTO,
    width: 1000,
    height: 600,
    backgroundColor: '#000000',
    scene: {
        preload: preload,
        create: create,
        update: update
    }
};

const regularLayout = [
    '` 1 2 3 4 5 6 7 8 9 0 - =',
    'q w e r t y u i o p [ ] \\',
    'a s d f g h j k l ; \'',
    'z x c v b n m , . /'
];

const shiftLayout = [
    '~ ! @ # $ % ^ & * ( ) _ +',
    'Q W E R T Y U I O P { } |',
    'A S D F G H J K L : "',
    'Z X C V B N M < > ?'
];

let keysPressed = {};
let currentLayoutTextObjects = [];
let isShiftDown = false;

let game = new Phaser.Game(config);

function preload() {
    // You can preload images or fonts if necessary
}

function create() {
    this.keysText = {};

    drawKeyboard(regularLayout, this);

    this.fingerText = this.add.text(100, 250, '', { font: '24px Arial', fill: '#00ff00' });

    this.input.keyboard.on('keydown', (event) => {
        let key = getRepresentativeCharacter(event);
        if (isShiftDown && key.length === 1) {
            key = key.toUpperCase();
        }

        if (event.code === 'ShiftLeft' || event.code === 'ShiftRight') {
            isShiftDown = true;
            drawKeyboard(shiftLayout, this);
        } else {
            highlightKey(key, this, true);
            keysPressed[key] = true;
            updateKeyVisuals();
        }
    });

    this.input.keyboard.on('keyup', (event) => {
        let key = getRepresentativeCharacter(event);

        if (isShiftDown && key.length === 1) {
            key = key.toUpperCase();
        }

        if (event.code === 'ShiftLeft' || event.code === 'ShiftRight') {
            isShiftDown = false;
            drawKeyboard(regularLayout, this);
        } else {
            highlightKey(key, this, false);
            keysPressed[key] = false;
            updateKeyVisuals();
        }
    });
}

function update() {
    // Updates per game frame
}

function drawKeyboard(layout, scene) {
    currentLayoutTextObjects.forEach(textObject => textObject.destroy());
    currentLayoutTextObjects = [];

    let yPos = 300;

    layout.forEach((row) => {
        let xPos = 50;

        row.split(' ').forEach((key) => {
            const keyText = scene.add.text(xPos, yPos, key, { font: '20px Arial', fill: '#ffffff' });
            scene.keysText[key] = keyText;
            currentLayoutTextObjects.push(keyText);
            xPos += 40;
        });

        yPos += 50;
    });

    updateKeyVisuals();
}

function updateKeyVisuals() {
    for (let textObject of currentLayoutTextObjects) {
        if (keysPressed[textObject.text.toLowerCase()] || keysPressed[textObject.text.toUpperCase()]) {
            textObject.setFill('#ff0000');
        } else {
            textObject.setFill('#ffffff');
        }
    }
}

function highlightKey(key, scene, isKeyDown) {
    let fingerKey = key.toLowerCase(); // Ensure we're using the lowercase key for finger mapping

    if (!scene.keysText[key] || !keyToFingerMapping[fingerKey]) {
        return;
    }

    if (isKeyDown) {
        console.log("Key:", key, "Finger:", keyToFingerMapping[fingerKey]);
        scene.keysText[key].setStyle({ fill: '#ff0000' });
        const fingerUsed = keyToFingerMapping[fingerKey] || 'unknown';
        scene.fingerText.setText('' + fingerUsed);
    } else {
        scene.keysText[key].setStyle({ fill: '#ffffff' });
        scene.fingerText.setText('');
    }
}

function getRepresentativeCharacter(event) {
    if (event.key.length === 1) {
        return event.key.toLowerCase();
    } else if (event.code === 'ShiftLeft' || event.code === 'ShiftRight') {
        return event.code;  // Return the code for shift keys
    }
    return '';
}

</script>
</body>
</html>
